<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Survey Brain</title>
  <style>
    body { font-family: system-ui; margin: 20px; background: #f5f5f5; }
    h1 { color: #003366; }
    section { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    button { padding: 10px 20px; font-size: 16px; background: #0044cc; color: white; border: none; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Survey Brain</h1>
  <p>Evidence-based two-option recommender</p>

  <section>
    <label>Flow rate (L/min)</label><br>
    <input id="flow" type="number" value="12"><br><br>

    <label>System type</label><br>
    <select id="system">
      <option value="regular">Regular (open vented)</option>
      <option value="combi">Combi</option>
      <option value="system">System (with cylinder)</option>
    </select><br><br>

    <label>Customer persona</label><br>
    <select id="persona">
      <option value="elderly_couple">Elderly couple</option>
      <option value="young_family">Young family</option>
      <option value="empty_nester">Empty nester</option>
    </select><br><br>

    <button onclick="run()">Get 2 recommendations</button>
  </section>

  <section id="results"></section>

  <script>
    const CONFIG = {
      PROXY_URL: '/.netlify/functions/recommend'
    };

    async function run() {
      const flow = document.getElementById('flow').value;
      const system = document.getElementById('system').value;
      const persona = document.getElementById('persona').value;
      const payload = { flow, system, persona };

      const results = document.getElementById('results');
      results.innerHTML = 'Thinking...';

      try {
        const r = await fetch(CONFIG.PROXY_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!r.ok) throw new Error(await r.text());
        const data = await r.json();

        results.innerHTML = `
          <h2>Recommendations</h2>
          ${data.recommendations.map(r => `
            <p><b>${r.title}</b><br>${r.reason}</p>
          `).join('')}
        `;
      } catch (e) {
        results.innerHTML = `<b>Model call failed:</b> ${e.message}`;
      }
    }
  </script>
</body>
</html>